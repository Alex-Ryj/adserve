package com.arit.adserve.fop;

import java.awt.image.BufferedImage;
import java.io.BufferedOutputStream;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStream;

import javax.imageio.ImageIO;
import javax.xml.transform.Result;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.sax.SAXResult;
import javax.xml.transform.stream.StreamSource;

import org.apache.fop.apps.FOUserAgent;
import org.apache.fop.apps.Fop;
import org.apache.fop.apps.FopFactory;
import org.apache.fop.apps.MimeConstants;
import org.junit.jupiter.api.Test;

import com.arit.adserve.image.Utils;

public class FopTest {

	@Test
	public void testFile() throws Exception {
		//image data
		String imgSrc="data:image/jpeg;base64,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";

		// Step 1: Construct a FopFactory
		// the XSL FO file
        File xsltFile = new File("src/test/resources/fop/template.xslt");
        // the XML file which provides the input
        StreamSource xmlSource = new StreamSource(new File("src/test/resources/fop/emp.xml"));
        // create an instance of fop factory
        FopFactory fopFactory = FopFactory.newInstance(new File(".").toURI());
        // a user agent is needed for transformation
        FOUserAgent foUserAgent = fopFactory.newFOUserAgent();
        // Setup output
        OutputStream out = new BufferedOutputStream(new java.io.FileOutputStream(new File("src/test/resources/fop/img/emp.png")));
    
        try {
            // Construct fop with desired output format
            Fop fop = fopFactory.newFop(MimeConstants.MIME_PNG, foUserAgent, out);

            // Setup XSLT
            TransformerFactory factory = TransformerFactory.newInstance();            
            Transformer transformer = factory.newTransformer(new StreamSource(xsltFile));
            transformer.setParameter("imgSrc", imgSrc);
            // Resulting SAX events (the generated FO) must be piped through to FOP
            Result res = new SAXResult(fop.getDefaultHandler());

            // Start XSLT transformation and FOP processing
            // That's where the XML is first transformed to XSL-FO and then 
            // PDF is created 
            transformer.transform(xmlSource, res);
            
        } finally {
            out.close();
        }
	}
	
	@Test
	public void testFileWithCustomMetadata() throws Exception {
		//image data
		String imgSrc="data:image/jpeg;base64,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";

		// Step 1: Construct a FopFactory
		// the XSL FO file
        File xsltFile = new File("src/test/resources/fop/template.xslt");
        // the XML file which provides the input
        StreamSource xmlSource = new StreamSource(new File("src/test/resources/fop/emp.xml"));
        // create an instance of fop factory
        FopFactory fopFactory = FopFactory.newInstance(new File(".").toURI());
        // a user agent is needed for transformation
        FOUserAgent foUserAgent = fopFactory.newFOUserAgent();
        // Setup output
        ByteArrayOutputStream out = new ByteArrayOutputStream();
    
        try {
            // Construct fop with desired output format
            Fop fop = fopFactory.newFop(MimeConstants.MIME_PNG, foUserAgent, out);

            // Setup XSLT
            TransformerFactory factory = TransformerFactory.newInstance();            
            Transformer transformer = factory.newTransformer(new StreamSource(xsltFile));
            transformer.setParameter("imgSrc", imgSrc);
            // Resulting SAX events (the generated FO) must be piped through to FOP
            Result res = new SAXResult(fop.getDefaultHandler());

            // Start XSLT transformation and FOP processing
            // That's where the XML is first transformed to XSL-FO and then 
            // PDF is created 
            transformer.transform(xmlSource, res);
            BufferedImage bi = ImageIO.read (new ByteArrayInputStream(out.toByteArray()));
            byte[] resultBytes = Utils.pngWriteCustomData(bi, "key_meta", "value_meta");
            FileOutputStream fos = new FileOutputStream(new File("src/test/resources/fop/img/meta.png"));
            fos.write(resultBytes);
            fos.close();
           
            
        } finally {
            out.close();
        }
	}
}

